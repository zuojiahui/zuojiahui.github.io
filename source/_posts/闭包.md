---
title: JS闭包的理解
categories: JavaScript
tags:
  - 闭包
abbrlink: 50862
---
### 前言
**闭包函数:** 声明在一个函数中的函数数，叫做闭包函数
**闭包:** 内部函数总是可以访问其所在的外部函数中声明的参数和变量，即使在其外部函数被返回（寿命终结）了之后
### 特点
* 函数嵌套函数
* 函数内部可以引用函数外部的参数和变量
* 参数和变量不会被垃圾回收机制回收

### 优点
* 让外部访问函数内部变量成为可能
* 局部变量会常驻在内存中
* 可以避免使用全局变量，防止全局变量污染

### 缺点
* 滥用闭包会造成内存泄露，因为闭包中引用到的包裹函数中定义的变量都永远不会被释放，所以我们应该在必要的时候，及时释放这个闭包函数。

### 结论
**最终秘诀就这一句话:** 闭包找到的是同一地址中父级函数中对应变量最终的值
### 栗子1
```
function funA(){
  var a = 10;  // funA的活动对象之中;
  return function(){   //匿名函数的活动对象;
        alert(a);
  }
}
var b = funA();
b();  //10
```
### 栗子2
```
function outerFn() {
 var i = 0;
 function innerFn() {
    i++;
    console.log(i);
    }
    return innerFn;
}
var inner = outerFn(); //每次外部函数执行的时候,都会开辟一块内存空间,外部函数的地址不同，都会重新创建一个新的地址
inner();  // 1
inner();  // 2
inner();  // 3
var inner2 = outerFn();
inner2();  // 1
inner2();  // 2
inner2();  // 3
```
### 栗子3
```
var i = 0;
function outerFn(){
  function innnerFn(){
       i++;
       console.log(i);
  }
  return innnerFn;
}
var inner1 = outerFn();
var inner2 = outerFn();
inner1(); // 1
inner2(); // 2
inner1(); // 3
inner2(); // 4    
```
### 栗子4
```
function fn(){
	var a = 3;
	return function(){
		return  ++a;                                     
	}
}
alert(fn()());  // 4
alert(fn()());  // 4  
```
### 栗子5
```
function outerFn(){
var i = 0;
  function innnerFn(){
      i++;
      console.log(i);
  }
  return innnerFn;
}
var inner1 = outerFn();
var inner2 = outerFn();
inner1(); // 1
inner2(); // 1
inner1(); // 2
inner2(); // 2
```
### 栗子6
```
(function() { 
  var m = 0; 
  function getM() { return m; } 
  function seta(val) { m = val; } 
  window.g = getM; 
  window.f = seta; 
})(); 
f(100);
console.log(g());   //100  闭包找到的是同一地址中父级函数中对应变量最终的值 
```
### 栗子7
```
function a() { 
  var i = 0; 
  function b() {
      alert(++i)
      } 
  return b; 
} 
var c = a(); 
c();      //1 
c();      //2 
```
### 栗子8
```
function f() { 
  var count = 0; 
  return  function() { 
      count++; 
      console.info(count); 
  } 
} 
var t1 = f();
t1();     //1 
t1();     //2 
t1();     //3 
```
### 栗子9
```
function m1(){
     var x = 1;
     return function(){
          console.log(++x);
     }
}
 
m1()();   //2
m1()();   //2
m1()();   //2
 
var m2 = m1();
m2();   //2
m2();   //3
m2();   //4
```
### 栗子10
```

var  fn=(function(){
   var  i=10;
   function  fn(){
      console.log(++i);
   }
   return   fn;
})() 
fn();   //11
fn();   //12
```