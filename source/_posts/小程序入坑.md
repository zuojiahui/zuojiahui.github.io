---
title: 小程序入坑
categories: 小程序
tags:
  - 小程序
abbrlink: 5140
---

## 小程序简介

小程序是一种全新的连接用户与服务的方式，它可以在微信内被便捷地获取和传播，同时具有出色的使用体验。

### 小程序与普通网页开发的区别

小程序的主要开发语言是 JavaScript ，小程序的开发同普通的网页开发相比有很大的相似性。对于前端开发者而言，从网页开发迁移到小程序的开发成本并不高，但是二者还是有些许区别的。
`普通网页开发`:  
​ 渲染线程和脚本线程是互斥的。  
网页开发者可以使用到各种浏览器暴露出来的 DOM API，进行 DOM 选中和操作  
网页开发者需要面对的环境是各式各样的浏览器，PC 端需要面对 IE、Chrome、QQ 浏览器等，在移动端需要面对 Safari、Chrome 以及 iOS、Android 系统中的各式 WebView
`小程序`:  
渲染线程和脚本线程是分开的，分别运行在不同的线程中。  
小程序的逻辑层和渲染层是分开的，逻辑层运行在 JSCore 中，并没有一个完整浏览器对象，因而缺少相关的 DOM API 和 BOM API，这一区别导致了前端开发非常熟悉的一些库，例如 jQuery、 Zepto 等，在小程序中是无法运行的。同时 JSCore 的环境同 NodeJS 环境也是不尽相同，所以一些 NPM 的包在小程序中也是无法运行的。  
而小程序开发过程中需要面对的是两大操作系统 iOS 和 Android 的微信客户端，以及用于辅助开发的小程序开发者工具，小程序中三大运行环境也是有所区别的，如表所示。

| 运行环境         | 逻辑层         | 渲染层            |
| ---------------- | -------------- | ----------------- |
| iOS              | JavaScriptCore | WKWebView         |
| 安卓             | V8             | chromium 定制内核 |
| 小程序开发者工具 | NWJS           | Chrome WebView    |

### 小程序与普通网页开发文件对比

| 结构 | 传统 Web   | 微信小程序 |
| ---- | ---------- | ---------- |
| 结构 | HTML       | WXML       |
| 样式 | CSS        | WXCSS      |
| 逻辑 | JavaScript | JavaScript |
| 配置 | 无         | JSON       |

### 基本项目目录结构

<div align="left">
<img src="https://gitee.com/zuo_jiahui/blogimage/raw/master/img/微信图片_20211007212116.png" width = 50% height = 80% />
</div>

### 小程序配置文件

小程序应用程序会包括最基本的两种配置文件，一种是全局的 `app.json` 和 页面自已的 `page.json`

#### 全局配置

小程序根目录下的 `app.json` 文件用来对微信小程序进行全局配置，决定页面文件的路径、窗口表现、设置网络超时时间、设置多 `tab` 等。  
以下是一个包含了部分常用配置选项的 app.json ：

```
{
  "pages": [
    "pages/index/index",
    "pages/logs/index"
  ],
  "window": {
    "navigationBarTitleText": "Demo"
  },
  "tabBar": {
    "list": [{
      "pagePath": "pages/index/index",
      "text": "首页"
    }, {
      "pagePath": "pages/logs/index",
      "text": "日志"
    }]
  },
  "networkTimeout": {
    "request": 10000,
    "downloadFile": 10000
  },
  "debug": true
}
```

完整配置项说明请参考 [小程序全局配置](https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/app.html)

#### 页面配置

每一个小程序页面也可以使用同名 .json 文件来对本页面的窗口表现进行配置，页面中配置项会覆盖 app.json 的 window 中相同的配置项。

```
{
  "navigationBarBackgroundColor": "#ffffff",
  "navigationBarTextStyle": "black",
  "navigationBarTitleText": "微信接口功能演示",
  "backgroundColor": "#eeeeee",
  "backgroundTextStyle": "light"
}
```

完整配置项说明请参考 [小程序页面配置](https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/page.html)

#### sitemap 配置

小程序根目录下的 `sitemap.json` 文件用于配置小程序及其页面是否被微信索引
完整配置项说明请参考 [sitemap 配置](https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/sitemap.html)

## 基本语法

### 数据绑定

.js 文件

```
Page({
  data: {
    msg: "Hello !!!",
    num: 100,
    show: true,
    parson: {
      name: "鸣人",
      age: 18
    }
  },
})
```

.wxml 文件

```
<view>
  <!-- 字符串类型 -->
  <view>{{msg}}</view>
  <!-- 数字类型 -->
  <view>{{num}}</view>
  <!-- 布尔类型 -->
  <checkbox checked="{{show}}">是否展示</checkbox>
  <!-- 对象类型 -->
  <view>名字 : {{parson.name}} 年龄 : {{parson.age}}</view>
</view>
```

### 运算
```
<view>
  <!-- 数字加减 -->
  <view>{{1 + 1}}</view>
  <!-- 字符串拼接 -->
  <view>{{"1" + "1"}}</view>
  <!-- 三元表达式 -->
  <view>{{10 % 2 === 0 ? "偶数" : "奇数"}}</view>
</view>
```
### 列表渲染
.js 文件
```
Page({
  data: {
    dataList: [{
        id: 1,
        name: "鸣人"
      },
      {
        id: 2,
        name: "佐助"
      },
      {
        id: 2,
        name: "雏田"
      },
      {
        id: 2,
        name: "小樱"
      },
    ],
    parson: {
      name: "鸣人",
      age: 18
    }
  },
})
```
.wxml 文件
```
<view>
  <!-- wx:for="{{数组或者对象}}" wx:for-item="循环项的名称" wx:for-index="循环项的索引" wx:key="唯一值，用于提高列表渲染性能" -->
  <!-- 如果数组为普通数组 列如：[1,2,3,4]   wx:key="*this"  *this 表示循环项-->
  <!-- 
  默认情况下:
  可以不写 wx:for-item="item"  wx:for-index="index"，小程序会默认添加(只有一层循环下可以省略)
  当出现 数组的嵌套循环的时候 以下绑定 不能重名
  wx:for-item="item"  wx:for-index="index"
  -->
  <view wx:for="{{dataList}}" wx:for-item="item" wx:for-index="index" wx:key="id">
    索引 ：{{index}}
    值 ： {{item.name}}
  </view>

  <view wx:for="{{parson}}" wx:for-item="value" wx:for-index="key" wx:key="id">
    属性：{{key}}
    值：{{value}}
  </view>
</view>
```
### 条件渲染
```
<!-- 
  场景使用：
   wx:if ：当标签不是频繁切换的时候优先使用 （直接把标签从页面移除）
   hidden ：当标签频繁切换的时候优先使用 （通过使用样式的方式来切换显示）
   注意 ：(hidden 属性不可和样式 display 一起使用，否则 hidden 属性会失效)
-->
<view>
  <!-- wx:if="{{true/false}}" -->
  <view wx:if="{{true}}"> 显示 </view>
  <view wx:if="{{false}}"> 隐藏 </view>

  <!-- wx:if  wx:elif wx:else-->
  <view wx:if="{{false}}"> 1 </view>
  <view wx:elif="{{false}}"> 2 </view>
  <view wx:else> 3 </view>

  <!-- hidden 默认为 true-->
  <view hidden="{{false}}">hidden1</view>
  <view hidden>hidden2</view>
</view>
```
### 事件绑定
.js 文件
```
Page({
  data: {
    num: 0
  },

  // 输入框事件
  handInput(e) {
    this.setData({
      num: Number(e.detail.value)
    })
  },

  //加 减 事件 
  handbindtap(value) {
    const num = value.currentTarget.dataset.num
    this.setData({
      num: this.data.num + num
    })
  }
})
```
.wxml 文件
```
<view>
  <input type="text" bindinput="handInput" />
  <button bindtap="handbindtap" data-num="{{1}}">+</button>
  <button bindtap="handbindtap" data-num="{{-1}}">-</button>
  <view>{{num}}</view>
</view>
```